var LoadGLBFromMessage=pc.createScript("loadGLBFromMessage");LoadGLBFromMessage.prototype.initialize=function(){console.log(SaveSystem.getInstance().data.url),this.load(SaveSystem.getInstance().data.url)},LoadGLBFromMessage.prototype.load=function(e){var o=this.app;console.log(e),pc.http.get(e,{responseType:"arraybuffer"},(function(e,t){if(e)console.error("Ошибка загрузки GLB:",e);else{var a=new Blob([t],{type:"model/gltf-binary"}),r=URL.createObjectURL(a);o.assets.loadFromUrl(r,"container",(function(e,t){if(e)console.error("Ошибка загрузки контейнера:",e);else{var a=t.resource.instantiateRenderEntity();a.setLocalPosition(0,0,0),a.setLocalScale(1,1,1),o.root.addChild(a)}}))}}))};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("target",{type:"entity",title:"Target"}),OrbitCamera.attributes.add("distance",{type:"number",default:5,title:"Distance from Target"}),OrbitCamera.attributes.add("minDistance",{type:"number",default:2,title:"Min Distance"}),OrbitCamera.attributes.add("maxDistance",{type:"number",default:15,title:"Max Distance"}),OrbitCamera.attributes.add("sensitivity",{type:"number",default:.3,title:"Mouse Sensitivity"}),OrbitCamera.attributes.add("zoomSensitivity",{type:"number",default:1,title:"Zoom Sensitivity"}),OrbitCamera.prototype.initialize=function(){this.yaw=0,this.pitch=0,this.isMouseDown=!1,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)},OrbitCamera.prototype.onMouseDown=function(t){t.button===pc.MOUSEBUTTON_LEFT&&(this.isMouseDown=!0)},OrbitCamera.prototype.onMouseUp=function(t){t.button===pc.MOUSEBUTTON_LEFT&&(this.isMouseDown=!1)},OrbitCamera.prototype.onMouseMove=function(t){this.isMouseDown&&(this.yaw-=t.dx*this.sensitivity,this.pitch-=t.dy*this.sensitivity,this.pitch=pc.math.clamp(this.pitch,-89,89))},OrbitCamera.prototype.onMouseWheel=function(t){this.distance-=t.wheel*this.zoomSensitivity*.1,this.distance=pc.math.clamp(this.distance,this.minDistance,this.maxDistance)},OrbitCamera.prototype.update=function(t){if(this.target){var i=new pc.Quat;i.setFromEulerAngles(this.pitch,this.yaw,0);var e=new pc.Vec3;e.copy(this.target.getPosition());var s=new pc.Vec3(0,0,this.distance);i.transformVector(s,s),e.add(s),this.entity.setPosition(e),this.entity.lookAt(this.target.getPosition())}};var Rotate360=pc.createScript("rotate360");Rotate360.attributes.add("target",{type:"entity"}),Rotate360.attributes.add("radius",{type:"number",default:5}),Rotate360.attributes.add("rotationSpeed",{type:"number",default:30}),Rotate360.attributes.add("minRadius",{type:"number",default:2}),Rotate360.attributes.add("maxRadius",{type:"number",default:10}),Rotate360.attributes.add("zoomSpeed",{type:"number",default:1}),Rotate360.prototype.initialize=function(){this.angle=0,this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)},Rotate360.prototype.update=function(t){if(this.target){this.angle+=pc.math.DEG_TO_RAD*this.rotationSpeed*t;var e=this.target.getPosition(),a=e.x+this.radius*Math.sin(this.angle),i=e.z+this.radius*Math.cos(this.angle),o=e.y+2;this.entity.setPosition(a,o,i),this.entity.lookAt(e)}},Rotate360.prototype.onMouseWheel=function(t){this.radius-=t.wheel*this.zoomSpeed*.1,this.radius=pc.math.clamp(this.radius,this.minRadius,this.maxRadius),t.event.preventDefault()},Rotate360.prototype.destroy=function(){this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)};var LoadGLB=pc.createScript("loadGLB");LoadGLB.prototype.initialize=function(){function addMessageListener(){window.vuplex.addEventListener("message",(e=>{var a=e.data;"string"==typeof a&&a.endsWith(".glb")&&(console.log("Получена ссылка на модель:",a),SaveSystem.getInstance().data.url=a,console.log(1),console.log(SaveSystem.getInstance().data.url),SaveSystem.getInstance().save())}))}console.log("Init1"),window.vuplex?addMessageListener():window.addEventListener("vuplexready",addMessageListener)};var SaveSystem=pc.createScript("saveSystem");SaveSystem.app=null,SaveSystem.instance=null,SaveSystem.prototype.data={url:null},SaveSystem.prototype.storageKey="myGameSave112333331",SaveSystem.getInstance=function(){if(!SaveSystem.instance){console.warn("SaveSystem instance not found. Creating new one.");var e=new pc.Entity("SaveSystem");e.addComponent("script"),e.script.create("saveSystem"),pc.app.root.addChild(e)}return SaveSystem.instance},SaveSystem.prototype.initialize=function(){if(SaveSystem.instance)return console.warn("SaveSystem already exists"),void this.entity.destroy();SaveSystem.app=this.app,SaveSystem.instance=this,this.load(),this.entity.reparent(null),window.addEventListener("beforeunload",this.save.bind(this))},SaveSystem.prototype.update=function(e){this.saveTimer||(this.saveTimer=0),this.saveTimer+=e,this.saveTimer>=5&&(this.save(),this.saveTimer=0)},SaveSystem.prototype.save=function(){try{var e=JSON.stringify(this.data);localStorage.setItem(this.storageKey,e)}catch(e){console.error("Failed to save:",e)}},SaveSystem.prototype.load=function(){try{var e=localStorage.getItem(this.storageKey);e&&(this.data=JSON.parse(e),console.log("[SaveSystem] Loaded:",this.data))}catch(e){console.error("Failed to load:",e)}};var ScaleRectByScreenWidth=pc.createScript("scaleRectByScreenWidth");ScaleRectByScreenWidth.attributes.add("scaleFactor",{type:"number",default:1,title:"Scale Factor",description:"Коэффициент масштабирования (от 0 до 1)"}),ScaleRectByScreenWidth.attributes.add("refResolution",{type:"vec2",default:[1920,1080],title:"Reference Resolution",description:"Базовое разрешение экрана"}),ScaleRectByScreenWidth.attributes.add("targetRects",{type:"entity",array:!0,title:"Target Rects",description:"Список целевых объектов для масштабирования"}),ScaleRectByScreenWidth.prototype.initialize=function(){this.initScales=[];for(var t=0;t<this.targetRects.length;t++){var e=this.targetRects[t];e&&(this.initScales[t]=e.getLocalScale().clone())}this.lastWidth=this.app.graphicsDevice.width,this.lastHeight=this.app.graphicsDevice.height,this.updateScale()},ScaleRectByScreenWidth.prototype.update=function(){var t=this.app.graphicsDevice.width,e=this.app.graphicsDevice.height;t===this.lastWidth&&e===this.lastHeight||(this.lastWidth=t,this.lastHeight=e,this.updateScale())},ScaleRectByScreenWidth.prototype.updateScale=function(){var t=this.app.graphicsDevice.width,e=this.app.graphicsDevice.height;if(0!==t&&0!==e){var i=this.refResolution.x/this.refResolution.y,a=t/e;if(a<i)for(var c=pc.math.lerp(1,a/i,this.scaleFactor),s=0;s<this.targetRects.length;s++){if(r=this.targetRects[s]){var h=this.initScales[s];r.setLocalScale(h.x*c,h.y*c,h.z)}}else for(s=0;s<this.targetRects.length;s++){var r;if(r=this.targetRects[s]){h=this.initScales[s];r.setLocalScale(h.x,h.y,h.z)}}}else this.app.once("postupdate",this.updateScale,this)};var LoadModel=pc.createScript("loadModel");LoadModel.prototype.initialize=function(){this.entity.element.on("click",this.start,this)},LoadModel.prototype.start=function(){SaveSystem.app.scenes.changeScene("Model")};